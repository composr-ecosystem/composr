[title sub="Written by Chris Graham (ocProducts)"]Composr Tutorial: eCommerce[/title]

{!ecommerce:DOC_ECOMMERCE}

The eCommerce system may also be used with community points.

[contents]decimal,lower-alpha[/contents]

[title="2"]Payment gateways[/title]

[surround]
[box="Important -- research your gateway" width="25em" float="right"]
[media float="right" thumb="0" framed="0"]data_custom/images/docs/remember.png[/media]
It is the webmaster's responsibility to research any payment system before use, to convince themselves they are happy with the quality and terms of service.

While Composr by default only supports particular payment gateways, this should not be considered an endorsement of any of those services.
[/box]
To accept payment in the modern world, an organisation must obviously have some kind of 'tie in' to the banking system.
The banking system runs with international standards for things such as:
 - credit cards
 - debit cards
 - cheques ('checks' in American English)

Cheque processing is relatively straight forward, but more infrastructure is needed to process credit or debit cards. This is accomplished by using a [concept]payment gateway[/concept] in one of two ways:
1) By getting an agent to fully handle the transaction and relay the funds
2) By having a merchant account with a bank, using the banks infrastructure and your bank account to manage the transaction yourself

Composr, by default, allows payment via {$IS_MAINTAINED,gateway_paypal,PayPal} & {$IS_MAINTAINED,gateway_ccbill,CCBill} & {$IS_MAINTAINED,gateway_authorize,Authorize.Net}, although it could be extended to support any kind of payment gateway if extended and customised by an appropriate professional. PayPal is fully supported; others are not regularly tested and intended for developers (usage instructions are included as comments within Composr's source code for the particular payment gateway).

PayPal was chosen because it is without doubt the leading form of payment on the Internet, easy to setup, and flexible in that it can provide support for funding direct from bank accounts, or cheque, as well as debit and credit card processing. Lots of people do not like PayPal policies, but we have no official position on this -- development priorities simply follow funding.
[/surround]

[title="3"]Specific gateway notes[/title]

[title="4"]PayPal[/title]

To accept website payments via credit card, or to take subscriptions, [url="you will need a Business Account"]https://www.paypal.com/us/webapps/helpcenter/helphub/article/?solutionId=FAQ2347[/url]. The business accounts are free, but the fees are higher.

You will need to have SSL set up for your site, as PayPal requires Instant Payment Notification (IPN) messages to go via SSL, and we have already imposed this in our default code.

You must [b]not[/b] lock down PayPal to [url="only accept encrypted forms"]https://developer.paypal.com/docs/paypal-payments-standard/integration-guide/encryptedwebpayments/[/url]. Composr does not encrypt forms.

If you want to set up Payment Data Transfer (PDT), follow these instructions:
 - Go to your PayPal's Website Payments settings, and Website Payment Preferences page.
 - turn on &ldquo;Auto Return&rdquo;.
 - For the return URL, specify your baseURL/index.php?page=purchase (e.g. https://www.example.com/index.php?page=purchase).
 - Turn on &ldquo;Payment data transfer&rdquo;.
 - Copy the data transfer identifier that appears on your screen.
 - On your Composr website, go to Admin Zone > Setup > Configuration > eCommerce options > Payment gateway (PayPal-specific).
 - Paste the data transfer identifier in the relevant box, and save.
PDT may be particularly useful in a development (testing) environment where PayPal cannot reach your website via IPN (especially if you are only running on localhost).

[title="3"]Configuration[/title]

To configure the payment gateway settings go to Admin Zone > Setup > Configuration > eCommerce options.

[title="3"]Config options[/title]

The option requirements for PayPal are as follows:

[html]
<table class="map-table results-table wide-table autosized-table"><tbody>
	<tr>
		<th>
			Payment gateway > Payment gateway
		</th>
		<td>
			<kbd>paypal</kbd>
		</td>
	</tr>
	<tr>
		<th>
			General > Use local payment
		</th>
		<td>
			This must be disabled
		</td>
	</tr>
	<tr>
		<th>
			Payment gateway > Gateway password
		</th>
		<td>
			This should be blank
		</td>
	</tr>
	<tr>
		<th>
			Payment gateway > Gateway VPN username
		</th>
		<td>
			This should be blank
		</td>
	</tr>
	<tr>
		<th>
			Payment gateway > Gateway VPN password
		</th>
		<td>
			This should be blank
		</td>
	</tr>
	<tr>
		<th>
			Payment gateway > Callback password
		</th>
		<td>
			This should be blank
		</td>
	</tr>
	<tr>
		<th>
			Address
		</th>
		<td>
			This section should be filled in if you are collecting sales tax. If you do not have a business headquarters, use the location from which you are selling items.
		</td>
	</tr>
	<tr>
		<th>
			Payment gateway > Gateway username
		</th>
		<td>
			For PayPal it is your PayPal e-mail address, but for other gateways it probably is just be any you receive e-mail on
		</td>
	</tr>
	<tr>
		<th>
			Payment gateway (testing mode) > Gateway username
		</th>
		<td>
			Your PayPal e-mail address (for the testing mode one, it's your sandbox PayPal e-mail address).
		</td>
	</tr>
</tbody></table>
[/html]

Documentation for other Payment gateways is provided in notes at the top of the [tt]sources/hooks/systems/payment_gateway/<gateway>.php[/tt] file. Payment systems tend to be a bit complex and ones other than PayPal are best set up by programmers who know the particular ways messages and security works between your site and the gateway.

[title="3"]Test mode[/title]

All supported payment gateways provide a test mode, which is turned on from the Admin Zone Configuration. Test mode allows you to make purchases from your website using the full eCommerce architecture of Composr and the payment gateway, except no money will actually be charged (it's a simulation mode) -- the ideal way to test your setup without risking real money.

To prevent purchases being made by real people that you don't receive real money for, only members in a usergroup with the 'Access eCommerce system when in test mode' permission may purchase when test mode is enabled (A message will be seen by others: "Purchasing is temporarily offline for maintenance. It should be back online within 24 hours: please try again later."). You have two supported testing choices:
1) Enable this permission for all usergroups and test the eCommerce when the website is closed (using the SU feature, see the [page="_SEARCH:tut_permissions"]Testing access and privileges[/page] tutorial, Access control and privileges section)
2) Test the eCommerce from your own admin account

For PayPal test mode goes through the [url="PayPal sandbox"]https://developer.paypal.com/classic-home/[/url]. Sign up on the sandbox (this is your test account for making the sale), log in, and create a test user (this is your test account for purchasing).
Be advised that we have found the PayPal sandbox to be buggy. If your tests fail with errors like "The link you have used to enter the PayPal system is invalid. Please review the link and try again." then you may be experiencing bugs in the PayPal sandbox. By all means, please complain to PayPal about it -- we have run tests and found the sandbox fails midway through purchases on configurations that work correctly for live payments.

[title="2"]Monetary system[/title]

[title="3"]Currencies[/title]

The currency the website works in is defined in the configuration. If you use PayPal you need to make sure your account can accept this currency and is not set up to allow people to choose which currency to pay in (as it stops Composr being able to verify the payment if they use this feature).

Composr can process transactions in any currency, but basically is only configured with a single currency. There are 2 reasons for this:
1) So custom eCommerce products can be written to transact in any currency required
2) So active invoices, active subscriptions, pending payments, and logged payments, all continue to be accurate if the main configured currency is changed

Composr can automatically do currency conversions for visitors (there's a configuration option to control this).

[title="3"]Points verses money[/title]

Many of the products allow configurability over whether they are sold for money or for points, or some combination (a discount via using points). Products that support both money and points typically also allow a 50:50 purchase option too. Users don't choose which option, the system will calculate it for them -- but they are told the discount they will get.

When selling products fully with points, it is assumed that tax and shipping will not be charged. As such, tax and shipping will not be included. If selling products at a discount via points, shipping will still apply via money, and tax will be adjusted according to the discounted price.

Gambling is only available via points.
Usergroup subscriptions are only available via money (as there's already a points-based rank ladder system).
Catalogue products are only available via money, although you can set up custom products that represent shippable items that can be purchased with points.

[title="2"]Products overview[/title]

[media width="150" description="The eCommerce layering in Composr for usergroup subscriptions" float="right"]data_custom/images/docs/tut_ecommerce/ecommerce_layer.png[/media]
Composr has an abstract system of 'products' that may be 'purchased'. These Composr products are not the same as products that are available from shopping-cart systems, but rather, special types of purchasable product or service that have their own code to handle their purchase.

In Composr by default there are the following 'kinds' of 'product':
 - [b]usergroup subscription[/b]: you may configure as many usergroup subscriptions as you wish, and these are all handled by the 'Usergroup' product kind. Each configured subscription is considered a 'product' for sale on your site.
 - [b]catalogue items[/b]: these are items for sale from the shopping catalogue
 - [b]orders[/b]: these products are a collection of other products bound into a group, and generated when someone finalises an order from the shopping cart
 - [b]e-mail addresses[/b]: these are e-mail addresses on your domain that you'd set up manually after they are purchased (may be purchased as [i]pop3[/i] or [i]forwarders[/i]). Quota upgrades for pop3 accounts may be purchased.
 - [b]topic pinning[/b]: pinning of requested topics on the forum
 - [b]name highlighting[/b]: highlighting of a member's name on the forum
 - [b]banners[/b]: banner advertisements, and upgrades.
 - [b]custom products[/b]: custom products that you give a label and description and set up manually
 - [b]permission products[/b]: permissions that you give a label and description and are automatically assigned. This can be used for selling access to download categories, for example.
 - [b]gambling[/b]: users may get points worth more than they pay, although on average they'll lose money/points
 - [b]work[/b]: this is a generic kind of product used to represent something that has been invoiced
 - Various kinds of [b]non-purchasable product[/b] that exist for accounting purpose -- [tt]interest[/tt], [tt]tax[/tt], [tt]wage[/tt] and [tt]other[/tt]. These aren't for sale on your site but positive or negative transaction sums can be entered against them in the Admin Zone, so your profit/loss and cash-flow charts can be accurate.
Only the products you want will be available.
When a member buys something, the staff are informed of it via e-mail of appropriate details.

[media width="150" description="Configuring products" float="right"]data_custom/images/docs/tut_ecommerce/purchasing_products_config.png[/media]
[media width="150" description="Configuring prices" float="right"]data_custom/images/docs/tut_ecommerce/purchasing_products_prices.png[/media]
[media width="150" description="The purchasing module" float="right"]data_custom/images/docs/tut_ecommerce/purchasing_products.png[/media]
Product kinds fit into the following general categories:
 - [b]One-off purchase[/b]: purchases made from the [tt]purchase[/tt] module ([tt]site:purchase[/tt] page-link, Content > Purchasing on the default menus) (above: e-mail addresses, topic pinning, name highlighting, banners, custom products, permission products, gambling)
 - [b]Subscription[/b]: one-off purchases made from the [tt]purchase[/tt] module ([tt]site:purchase[/tt] page-link, Content > Purchasing on the default menus) and managed from the [tt]subscriptions[/tt] module ([tt]site:subscriptions[/tt] page-link, linked from member accounts) (above: usergroup subscriptions)
 - [b]Shopping cart[/b]: an item purchased from the [tt]catalogue[/tt]/[tt]shopping[/tt] modules ([tt]site:catalogues[/tt]/[tt]site:shopping[/tt] page-links, Content > Products and Content > Shopping Cart, on the default menus) (above: catalogue items)
 - [b]Invoice[/b]: requests for payment created from the Admin Zone, paid for from the [tt]invoices[/tt] module ([tt]site:invoices[/tt] page-link, linked from member accounts) (above: work)
 - [b]Other[/b] (above: interest, tax, wage, other)

While the abstraction of this may be confusing, it is very beneficial as all kinds of automatically handled products may be programmed to integrate with Composr functionality.
For example, a programmer could create the following with relative ease:
 - a product that increases the number of available hits on banners
 - a product that sends out an e-mail to a dispatch warehouse instructing them to mail out a copy of a bands latest album to the address specified in the member profile of the buyer.
Most useful kinds of purchase can, however, be achieved with the default usergroup product: a usergroup for which membership can be purchased could be given additional permissions that reflect access to features or areas of the website that would not otherwise be available. This is how most websites will use the eCommerce system because it is simple, effective, works well with PayPal, and does not require programmers to implement.

[title="2"]Purchasing module products[/title]

Inventory management is at:
Admin Zone > Setup > eCommerce inventory management
Use this to set up those products which users can have multiple of (e-mail accounts, custom products, permission products).

Other prices are set in normal configuration options.

If you are running Conversr then there will be a member tab showing past purchases.

[title="3"]Banners[/title]

While by default any member may submit a banner, the implication is that an eCommerce-purchased banner would not have to serve the staff's interests so much as a banner they decided to validate for free.

All banners purchased are added to the 'General' banner type.

[title="3"]Topic pinning[/title]

On [concept]Conversr[/concept] sites, members can purchase to have a particular topic pinned on the forum.

[title="3"]Gambling[/title]

Members can gamble points. On average, members lose out on points when they try and gamble them though.

[title="3"]Name highlighting[/title]

On [concept]Conversr[/concept] sites, highlighted usernames can be purchased. This means the buyer's name gets special highlighting within forum topics.

[title="3"]Permission products[/title]

[media width="150" description="Configuring permission products via the inventory management screen" float="right"]data_custom/images/docs/tut_ecommerce/inventory_permissions.png[/media]
Staff can set up what permissions may be purchased, how long they last for, and the prices.

This is done via the inventory management screen at:
Admin Zone > Setup > eCommerce inventory management

The different types of permission (product) are configured with settings as follows:

[title="4"]Privilege[/title]

If a privilege is set globally, you will only set &ldquo;The privilege&rdquo;.

If you are scoping it to a particular module page (e.g. &ldquo;downloads&rdquo;), you will also set &ldquo;The page&rdquo;.

If you are scoping it to a particular category, you will also set it to &ldquo;The module codename&rdquo; and &ldquo;The category&rdquo;.

[title="4"]Zone-access[/title]

You will only set &ldquo;The zone&rdquo;.

[title="4"]Page-access[/title]

You will set &ldquo;The zone&rdquo; and &ldquo;The page&rdquo;.

[title="4"]Category-access[/title]

You will set &ldquo;The module codename&rdquo; and &ldquo;The category&rdquo;.

Normally &ldquo;The category&rdquo; will be a numeric ID.

This said, when you add or edit a category you can automatically set up the permission product on the normal form.

Categories that a user does not have permission to will not be linked. So to promote sale of access to those categories you may want to either direct users directly into the Purchasing module, or link to the sale pages from the description of the parent download category.

[title="5"]Download categories[/title]

Download category access is implemented as a special case. The contents of the download category will be e-mailed out directly upon purchase.
This is great for selling things like eBooks and audio files.
You can configure the maximum file size for sent files. Files above this size will be omitted.
Externally hosted files will also be omitted.

[title="3"]Custom products[/title]

[media width="150" description="Configuring custom products via the inventory management screen" float="right"]data_custom/images/docs/tut_ecommerce/inventory_custom.png[/media]
Staff set up custom products by description and price, then members may buy them. Staff then must manually dispatch the custom product, whatever it is.
This is done via the inventory management screen at:
Admin Zone > Setup > eCommerce inventory management

[title="3"]E-mail accounts (advanced)[/title]

[media width="150" description="Configuring pop3 accounts via the inventory management screen" float="right"]data_custom/images/docs/tut_ecommerce/inventory_pop3.png[/media]
[media width="150" description="Configuring e-mail forwarders via the inventory management screen" float="right"]data_custom/images/docs/tut_ecommerce/inventory_forwarding.png[/media]
By selling e-mail accounts you are essentially selling a prestige address to your members. Members might love having an address like [tt]sam@yourawesomesite.com[/tt].

What may be purchased:
 - POP3 e-mail accounts, and upgrades
  - staff define which e-mail domains members may purchase addresses on
  - staff must set up the e-mail accounts manually after they are purchased/upgrades
 - e-mail Forwarding accounts, and updates
  - staff define which e-mail domains members may purchase addresses on
  - staff must set up the e-mail accounts manually after they are purchased/upgrades

These may be configured via the inventory management screen at:
Admin Zone > Setup > eCommerce inventory management

If e-mail accounts are sold Composr cannot create them itself. Instead, it has to send out e-mail notifications to the site staff address, which includes details of how to add them. The method of addition is different for different systems, so the eCommerce configuration defines 3 URLs that can be set according to your server.

Example URLs follow for different webhosting control-panel software (please note that these may not be up-to-date with newer versions of these control-panels)...

[title="4"]For Plesk users[/title]

The mail add address (POP3 and forwarding) is:
[indent][tt]https://{DOMAIN}:8443/domains/mail/mail_name_preferences.php?mn_id=0&previous_page=mail_names[/tt][/indent]
Forwarders are added through adding a mail address, and then specifying a forwarder for it.

We're not sure if it is currently possible to manage POP3 quota with Plesk.

[title="4"]For Ensim users[/title]

The POP3 add address is:
[indent][tt]http://{DOMAIN}/Site/email_users_add.htm[/tt][/indent]

The forwarding add address is:
[indent][tt]http://{DOMAIN}/Site/emal_forward.htm[/tt][/indent]
We're not sure if it is currently possible to manage POP3 quota with Ensim.

[title="4"]For cPanel users[/title]

The POP3 add address is:
[indent][tt]http://{DOMAIN}:2082/frontend/x/mail/addpop2.html[/tt][/indent]

The forwarding add address is:
[indent][tt]http://{DOMAIN}:2082/frontend/x/mail/addfwd.html[/tt][/indent]

The POP3 quota change address is:
[indent][tt]http://{DOMAIN}:2082/frontend/x/mail/pops.html[/tt][/indent]

[title="3"]Community billboard (non-bundled)[/title]

[i]As of Composr 10, the community billboard is a non-bundled addon.[/i]

[surround]
{!community_billboard:DOC_COMMUNITY_BILLBOARD}

The queue is accessed via the Staff Checklist on the Admin Zone dashboard. Note that the queue is not self-managed, you need to control which message is active, as they won't automatically rotate or expire. We mentioned above that the staff are automatically notified when a purchase is made, but actually this isn't the case for the community billboard.

Messages may be manually added in the Admin Zone (a link is on the dashboard checklist), but regular users will be purchasing them. When that happens, you are notified of the new message have been added.

For the community billboard to display, you must place the symbol code, [tt]{$COMMUNITY_BILLBOARD}[/tt] into a template or page. Commonly this would be into [tt]GLOBAL_HTML_WRAP.tpl[/tt] so that it can show somewhere in the page footer.

[media width="150" description="Managing community billboard messages in the queue" float="left"]data_custom/images/docs/tut_ecommerce/community_billboard_manage.png[/media]
[media width="150" description="Adding a community billboard message from the Admin Zone" float="left"]data_custom/images/docs/tut_ecommerce/community_billboard_add.png[/media]
[media width="150" description="Configuring the default community billboard message" float="left"]data_custom/images/docs/tut_ecommerce/default_community_billboard.png[/media]
[media width="150" description="The community billboard message could be shown in the footer" float="left"]data_custom/images/docs/tut_ecommerce/community_billboard_actual.png[/media]
[/surround]

[title="2"]Subscription products[/title]

[surround]
[media width="150" description="Adding a capability for a usergroup subscription" float="right"]data_custom/images/docs/tut_ecommerce/ecommerce_subscription.png[/media]
[media width="150" description="A link to the payment gateway to purchase." float="right"]data_custom/images/docs/tut_ecommerce/upgrade_3.png[/media]
[media width="150" description="The description of the usergroup subscription is shown. You'd normally put a more extensive description here, explaining why someone should upgrade." float="right"]data_custom/images/docs/tut_ecommerce/upgrade_2.png[/media]
[media width="150" description="Link to upgrade via a usergroup subscription." float="right"]data_custom/images/docs/tut_ecommerce/upgrade.png[/media]
Currently, subscriptions do not support shipping fees and therefore cannot be used for physical products requiring shipping.

Usergroup subscriptions are implemented on top of subscriptions.

Usergroup subscriptions are only available if the forum system is [concept]Conversr[/concept].

Set up a usergroup description as follows:
1) Add a usergroup that members will be able to subscribe to from Admin Zone > Security > Usergroups > Add usergroup. Make sure it is not 'Open membership', otherwise people could join it without paying.
2) Assign additional access to this usergroup (or remove access from some of the other usergroups!).
3) Go to Admin Zone > Setup > Usergroup subscription > Add usergroup subscription
4) Fill in the form. Be aware that a '5' 'monthly' subscription means someone pays 'every 5 months'. It does not mean a subscription is paid every month and lasts for 5 months -- subscriptions last indefinitely until the user chooses to cancel them.
5) Provide a path for members to visit the [tt]purchase[/tt] module so that they may activate their subscription, if one does not already exist (it does exist by default). By default this is possible via upgrade links shown in the logged-in box as per the above screenshot. You do also this via the [tt]purchase[/tt] module ([tt]site:purchase[/tt] page-link, Content > Purchasing on the default menus).

You can add as many usergroup subscriptions as you like, even multiple to the same usergroup. For example, [by adding more subscriptions] you could make it cheaper to subscribe yearly than monthly.

You can edit a usergroup subscription from:
Admin Zone > Setup > Usergroup subscription > Edit usergroup subscription
You can delete a usergroup subscription from the bottom of its edit form.

You can manually put someone into a subscription using a "Manual transaction". If you do so, it is up to you to manually expire members if they cease payments. You can do this from:
Admin Zone > Audit > eCommerce > View manual subscriptions

Note that for some payment gateways you need to be mindful about how subscription cancellation happens. At the time of writing only PayPal automatically cancels the subscription (and hence usergroup membership) within Composr once a subscription is remotely terminated. Some payment gateways can automatically cancel a subscription when a user [i]locally[/i] requests it in Composr, and in such a case Composr will automatically cancel the subscription on its end too. So, unless you're using PayPal, if you get an e-mail from a payment gateway saying a subscription is terminated you should manually make sure the user is kicked out of the subscription usergroup within Composr.
Be very careful when deleting users because subscriptions will be left hanging when you do and would need to be manually cleaned up.
[/surround]

[title="2"]Invoice products[/title]

[surround]
[media width="150" description="Invoicing a member" float="right"]data_custom/images/docs/tut_ecommerce/ecommerce_invoice.png[/media]
Members may be invoiced by the staff. To do this, go to the Admin Zone > Audit > eCommerce > Create invoice.

Members may view their invoicing history via links in their member profiles.

Staff may quickly locate unpaid invoices and invoices for which the work has not yet been fulfilled from:
Admin Zone > Audit > eCommerce > Invoices
[/surround]

[title="2"]Shopping catalogue items[/title]

The Composr shopping catalogue works via the existing Composr catalogues system. Out-of-the-box there is the shopping cart catalogue (called [tt]products[/tt]), although you can have multiple.

Shopping catalogues provide the following special functionality:
 - special templating for tidy product display
 - easy adding to the shopping cart
 - tax calculation
 - shipping cost calculation
 - stock counting

The Composr shopping catalogue has intentionally been kept lightweight. We're not trying to compete with the dedicated eCommerce systems on features, we're trying to provide something with fantastic Composr integration and extendibility that meets the majority of peoples' needs. This way we are able to compete by providing eCommerce as a part of the full Composr package, rather than a standalone eCommerce system that is bloated in its own way but lacking the features needed for a wider website.

You can access the default products catalogue for modifications, and adding products to, from Admin Zone > Content > Products.

[title="3"]Product fields[/title]

[media width="150" description="Viewing a shopping catalogue item" float="right"]data_custom/images/docs/tut_ecommerce/product_view.png[/media]
[media width="150" description="Adding a shopping catalogue item" float="right"]data_custom/images/docs/tut_ecommerce/product_add.png[/media]
This catalogue has some hard-coded fields:
 - [b]Product name[/b] -- the item's name
 - [b]Product code[/b] -- a code of your choice for the item (a SKU, stock keeping code); by default this is hidden and randomly generated (you can edit the catalogue and remove [tt]RANDOM[/tt] from the default field value if you want to enter it manually)
 - [b]Product image[/b] -- a picture of the item
 - [b]Product description[/b] -- a description of the item
 - Pricing:
  - [b]Price[/b] -- the item's price (pre-tax)
  - [b]Tax code[/b] -- the tax code, selected using a Composr tax code selector (e.g. you can enter a percentage tax)
 - Stock:
  - [b]Stock level[/b] -- the number in stock
  - [b]Stock level warn-threshold[/b] -- send out a notification to the staff if the stock goes below this level
  - [b]Stock maintained[/b] -- whether stock will be maintained; if the stock is not maintained then users will not be able to purchase it if the stock runs out
 - Shipping:
  - [b]Product weight[/b] -- the item's weight, in the configured units
  - [b]Product length[/b] -- the item's length, in the configured units
  - [b]Product width[/b] -- the item's width, in the configured units
  - [b]Product height[/b] -- the item's height, in the configured units

The fields are semantically tied into the system via the [tt]ecommerce_tag[/tt] field option. If [tt]ecommerce_tag[/tt] is not set then it will still try and match the fields using either the field types or the field names.

[media thumb="0" framed="0" float="right"]data_custom/images/docs/dont.png[/media]
You may add additional fields, such as extra product images or specifications. However do [b]not[/b] delete any of the default fields. If an eCommerce catalogue is not correctly configured errors will occur.

[title="4"]Multiple shopping catalogues (advanced)[/title]

If you want another shopping catalogue then add a new catalogue with the Advanced "eCommerce catalogue" option set, and all the same tagged fields.

[title="4"]Product options[/title]

A [url="popular request"]https://compo.sr/tracker/view.php?id=268[/url] is to be able to specify options when purchasing a product, such as size or colour.
This would be a major task for us to implement, and complicate the system, so we are not currently planning to add it.
There are, however, three workarounds:
1) Simply add the different product options as separate products.
2) If you are using PayPal a template edit can be used to let the PayPal buy button carry through an option selection. We have left an example in the [tt]ECOM_CART_BUTTON_VIA_PAYPAL.tpl[/tt] template. This workaround shifts the configuration burden over to being a template editing task, and shifts the administration burden onto PayPal's end.
3) Just ask the user what they want by e-mail after they order.

If you need more flexibility than this (perhaps many different product options for different kinds of product, or options that affect the price), you should consider either sponsoring extended Composr development, or using a dedicated third-party eCommerce system.

[title="3"]Product reviews[/title]

By default the catalogue is configured to allow product reviews, but you may turn these off if you wish.

[title="3"]Categories and entries (i.e. the contents of your product catalogue)[/title]

Once you are happy with your set of fields, you can add categories and entries to your catalogue. As this is exactly the same as adding entries to a normal catalogue, I'll refer you to the [page="_SEARCH:tut_catalogues"]Custom structured content (via catalogues)[/page] tutorial.

[title="4"]Deleting shopping cart items[/title]

[media thumb="0" framed="0" float="right"]data_custom/images/docs/dont.png[/media]
Be aware that once ordered, a catalogue entry shouldn't usually be deleted. You can unvalidate the entries instead (unselect 'Validated'), and/or move it into an archive category and/or set the stock to zero. This is vital to your ledger integrity. There is an option to forcibly purge an item from the database and all past order history for it, but it's not usually recommended.

[title="3"]Shopping catalogue[/title]

[media width="150" description="Viewing the shopping cart" float="right"]data_custom/images/docs/tut_ecommerce/product_cart.png[/media]
Once you have entries, and your eCommerce configuration is configured, users can start using the shopping catalogue (Content > Products, on the default menus). From here they will be able to navigate to the shopping cart ([tt]site:shopping[/tt] page-link, Content > Shopping cart on the default menus) and finalise and pay for their order.

You may customise the appearance of the shopping catalogue in the usual way of editing catalogue templates (the [tt]products[/tt] catalogue already has most of the templates overridden with eCommerce-tuned styles, so you do not need to worry about accidentally altering the look of non-eCommerce catalogues).

[title="4"]Guests[/title]

Guests may make purchases, if they have the necessary Composr permissions (to the [tt]catalogues[/tt] module, the [tt]products[/tt] catalogue, and the [tt]shopping[/tt] module).

Guest users have no member ID, so Composr will store the order against their 'session ID' instead. Session IDs work using cookies, secured against the user's IP address. The session can be lost in many circumstances:
 - if the user has their browser set to empty cookies when closed
 - after the session expiry time (the default for this is 1 hour, but it's a config option)
 - if the user's IP address changes (router's can sometimes do this, or ISPs may expire them routinely)
 - if the user switches web browsers or machines

We can't tie the purchases to IP addresses because often thousands of users can be on the same IP address.

If you think users may be making delayed purchases as guests, you may want to consider removing Guest permissions to the [tt]shopping[/tt] module, to force logins.

[title="3"]Handling orders[/title]

When orders are purchased:
1) a notification is sent out to the staff so they can manage the order
2) the stock level is adjusted.

The staff can follow a link in the notification to manage the order, or go manually to Audit > eCommerce > Shopping orders.

Options for managing the order include:
 - Changing the order status (e.g. mark as dispatched)
 - Adding a note to be sent to the buyer (e.g. providing a tracking URL)

Orders may be reviewed by the [i]buyer[/i] from their [tt]shopping[/tt] module (linked from their member profile)

[title="2"]Handling tax[/title]

Tax calculation has been kept as simple as reasonably possible because it's impossible to create configurability to cover every scenario people will need globally. Tax rules have too many special cases.

To provide a reasonable level of support we have:
 - Architected the calculations to go through tax hooks (systems/ecommerce_tax). Developers may expand on the functionality of the tax system by adding new tax hooks, say, to add support for another third party tax service.
 - Included support for international taxation of many countries (though not all of them) by integration of the [url="TaxJar"]https://taxjar.com/[/url] web service.
 - Included support for USA taxation across state/country/city lines by integration of the free [url="TaxCloud"]https://taxcloud.net/[/url] web service.
  - This allows support for 'nexuses'
  - This allows support for destination taxation state rules
 - Special support for EU digital goods taxation.
 - Support for custom specification of which Countries and States taxation applies within.

A big limitation with using the software (in-built) tax system opposed to a third party tax service is that the in-built system cannot handle different taxes for different products (tax codes).

When defining tax codes ('tax code' is the term we use) you can select with either:
a) a TaxJar (TJ) tax code
b) a TaxCloud (TIC) tax code
b) EU digital goods (which auto-selects the appropriate tax based on the buyer's country)
c) your own custom percentage rate.
Tax codes are carried through the system until it is time to turn into an actual tax figure, which is then stored in the database along with a 'derivation' of what exact tax fees were levied. To convert a tax code to an actual tax figure we need to know the shipping/invoicing address of the buyer, as this has an enormous impact on what exact tax is charged.

Known limitations and important considerations:
 - You should not enable automatic tax deduction on your payment gateway as Composr handles it for you. If tax deduction was enabled then transactions would fail to go through due to mismatches in pricing.
 - We cannot verify that a user has given their correct address when they pay, and hence know the correct tax to charge. However we believe tax authorities would generally recognise that such fraud is the fault of users rather than your own liability (this is standard practice), plus the address is also used for shipping which creates a reasonable barrier to fraud.
 - Before a buyer's address is known taxation is calculated as if the buyer was buying from the business's own address. This is so we can provide a "best estimate" of tax as early as possible.
 - We do not mention import duty in the software, which would often be due if shipping internationally. The buyer pays this to the shipping company before they will deliver the import. This is standard practice, and it is standard to not refer to it in eCommerce tax systems as it is outside the scope, but I thought it was worth mentioning.
 - We have designed the tax system to be legally compliant with at least EU and USA rules, although we cannot guarantee this -- you must take your own responsibility for your legal compliance.
 - Sales tax rates may be changed, but they would be changed at the start of a new tax accounting period. Unless you are using a third-party tax service for all the taxes then you must be aware of this, ready to switch in new rates at midnight when the new ones apply.
 - Avoid taking and holding multiple currencies (e.g. on PayPal) unless you have a very good reason to -- it will make your accounting particularly complicated. It is better to just force the buyer's credit card to charge in your own currency.
 - You should strongly consider setting the site timezone to that where you collect tax so that if tax rates change you can more easily tell what dates the transactions happened on.

[title="3"]Regional considerations[/title]

[title="4"]International Sales Tax[/title]
[media width="300" framed="0" float="right"]data_custom/images/docs/tut_ecommerce/tax.png[/media]
If you are selling products commercially, you may be required to pay sales tax depending on where your business is located and where you are serving (shipping) your products. This can get extremely complex especially in the US.

You must use the third-party TaxJar or TaxCloud service to assist with complex sales tax calculations and management; the software only supports simple taxes.

To use the TaxJar system:
1) Your site must have working SSL functionality (outbound)
2) Set up an account on TaxJar
3) Set up required details on TaxJar (shipping and billing details, business name, nexuses, etc); you will need your filing details such as your Federal Tax ID (EIN) if you plan to use TaxJar to file your taxes (not required)
4) Set up your payment information in the TaxJar Plan & Billing tab
5) Consider adding the "Sales Tax Policy" text to your Composr rules page
6) Fill in the "TaxJar API key" configuration option (Admin Zone > Setup > Configuration > eCommerce options > TaxJar) on your Composr site
7) Set all applicable Business address configuration options depending on your country
8) Set the "Currency" configuration option on your Composr site to the currency your business uses
9) Configure tax configuration options, and shopping catalogue items, to use the appropriate TaxJar code(s)
Note that if your Business country is set to US, Composr will also create tax transactions for you through the TaxJar API so you can file taxes through TaxJar.

To use the TaxCloud system (only available for US businesses at the time of writing):
1) Your site must have working SSL functionality (outbound)
2) Set up an account on TaxCloud
3) Set up required details on the TaxCloud Profile/Websites/Contacts/Locations tabs; you will need your filing details such as your Federal Tax ID (EIN)
4) Set up your payment information in the TaxCloud Payment Information tabs
5) Consider adding the "Sales Tax Policy" text to your Composr rules page
6) Fill in the "TaxCloud API key" configuration option (Admin Zone > Setup > Configuration > eCommerce options > TaxCloud) on your Composr site
7) Fill in the "TaxCloud API ID" configuration option on your Composr site
8) Set the "Business country" configuration option on your Composr site to US
9) Set the "Business state" configuration option on your Composr site to the state you operate your business from (make sure you enter a 2-character state code in upper case, not the full written state name)
10) You may ignore the "Tax countries" configuration option and "Tax states" configuration option
11) Set the "Currency" configuration option on your Composr site to USD
12) Configure tax configuration options, and shopping catalogue items, to use the appropriate TIC code(s)
Note that TaxCloud will automatically debit the tax from you and do tax forms for you in many cases -- and in any case will keep records of all the itemised sales taxes due.

[title="4"]USA users[/title]
USA tax is extremely complex as it may be levied at the federal level, state level, county level, and city level. For most USA states the tax is charged based on where the buyer resides ("destination taxation"), not the seller ("origin taxation"). That is, unless the buyer is in a state where you don't have any operations centre (in which case no sales tax applies at all unless there's a federal tax which is rare &dagger;).
All the taxes need to be individually tracked and paid out. It is necessary to use a third-party tax service like TaxJar or TaxCloud for this.

Known limitations at this time which could be worked around with custom code...
 - We don't support exemption certificates for buyers not needing to pay tax (e.g. some farmers in some cases)

&dagger; Instead of sales tax charged at point of sale, most sites have something called 'use tax'. 'Use tax' should be paid by the buyer themselves when they file their taxes. Very few people do, make of that what you will.

[title="4"]EU users[/title]

Sales tax in the EU is known as "VAT". It is technically different from a normal sales tax, but we don't need to get into that in this tutorial. There is a configuration option to make sure that the term "VAT" is used instead of the term "Sales tax".

Basically if you are selling products or services commercially, you must register with your government's tax office for VAT.
In the UK and some other countries there is an income threshold after which you need to register. If you don't you can't get rebate on purchases you make, but you also benefit competitively by being able to charge buyers less money. If you are selling digital goods then there is no threshold, you must collect VAT and remit it (e.g. via the "MOSS" if you are based in UK).

Known limitations at this time which could be worked around with custom code...
 - EU VAT-registered buyers may not input a VAT number to disable VAT charging -- they must use the government rebate process when they file tax returns (https://compo.sr/tracker/view.php?id=3062)

The EU system for calculating digital product taxes charges the tax rate of the buyer's country, not yours, and is then paid to the government in the buyer's country.
It only applies to certain digital sales, not shipped products. To use digital product tax:
1) You may ignore the "Tax countries" configuration option and "Tax states" configuration option unless you sell other products that have other tax codes
2) Configure tax configuration options, and shopping catalogue items, to use the "EU digital goods tax" tax code

[title="4"]Other users[/title]

Known limitations at this time which could be worked around with custom code...
 - No special consideration has been given for tax rules in any other particular jurisdiction -- instead we have tried to make it configurable

[title="3"]Tax invoices[/title]

Tax invoices are automatically created and delivered to buyers through notifications. They are also available from the Admin Zone.

[title="4"]Line items[/title]

Local laws may require tax invoices that show individual line items, each with their own tax rate. For example, shipping costs may be zero-rated, services may be given a service rate, and food may be given a food rate.

We support line items for:
 - shopping cart purchases: each individual item purchased is shown as a line item, as well as shipping costs.
 - for all eCommerce products that support a defined shipping cost we support showing this as a separate line item.

We do not support inputting line items individually in the Composr invoice system (separate from tax invoices). Composr invoices are designed for simple invoices with a common tax code covering the whole value of the invoice. You may workaround the limitation in 2 ways:
1) by manually preparing your own tax invoices, using the Composr system for tracking and payment, but not for any kind of official records. The tax code produced would be custom-calculated as the effective percentage tax rate covering the overall invoice.
2) create multiple invoices, so that you don't actually require separate line items

The same limitation applies to subscriptions, although this is not likely to be an issue as usually subscriptions wouldn't contain separate taxable items within them. The tax regulators would likely consider the subscription "atomic".

If you are setting up custom products it is possible these represent aggregate purchases and may suffer from this problem. However you likely could make a convincing case that it was all one "atomic" purchase also.

[title="3"]Tax derivation[/title]

The tax derivations will be needed for tax remittance if you are subject to EU digital goods tax, or to USA destination taxation.

We generally track these and they are available when you do a spreadsheet download of transactions.

However, TaxCloud and TaxJar don't actually provide us broken-down data of the taxes. So if you are using those services you'll find this data on their website itself.

[title="2"]Shipping[/title]

[title="3"]Handling shipping costs[/title]

[media width="300" framed="0" float="right"]data_custom/images/docs/tut_ecommerce/shippo.png[/media]
You should not enable automatic shipping cost calculation on your payment gateway (e.g. PayPal) as Composr handles it for you. If shipping cost calculation was enabled, then buyers might either be double-charged for shipping or otherwise charged the wrong amount.

You have 3 possible approaches for calculating shipping costs:[list="1"]
[*] Use the inbuilt configuration options for calculating shipping cost based on weight and dimensions. This may work reasonably if shipping costs are not going to vary by distance.
[*] Fill in the Shippo configuration to calculate based on weight, dimensions, and presumably distance. Shippo will provide an exact shipping cost by actual communication with your choice of shipping company. This is likely your best option as Shippo is free (you pay when you print shipping labels), although it may not work for businesses in every country.
[*] Customise the code. The shipping cost calculation in '1' has been kept very simple because it's impossible to create configurability to cover every scenario people will want globally. There are too many different special cases to cover. We have therefore architected the calculations to go through a simple common function that a programmer can override to add in additional behaviour if needed, [tt]calculate_shipping_cost[/tt].
[/list]

Known limitations at this time which could be worked around with custom code...
 - There's no way to give a product a flat rate for shipping (https://compo.sr/tracker/view.php?id=1520)
 - Free shipping above a certain payment amount is not supported (https://compo.sr/tracker/view.php?id=3064)
 - Customer-selectable shipping options are not supported (https://compo.sr/tracker/view.php?id=3065)

[title="4"]Shippo[/title]

Shippo is free because they make money helping you print shipping labels. We don't currently provide any special integration with that feature though.

1) Sign up to [url="Shippo"]https://goshippo.com/[/url]
2) Log into your Dashboard
3) Go to the API section
4) Copy the Live Token and Test Token into your eCommerce configuration (Admin Zone > Setup > Configuration > eCommerce options > Shipping).
5) Go to the Carriers section
6) Disable all but one carrier account (as Composr does not currently support shipping option choices); make sure the carrier account you leave supports international shipping (DHL Express does not, for example)

[title="3"]Shipping addresses[/title]

Some Custom Profile Fields are pre-installed to allow members to set their shipping address in their regular profile settings (instead of having to define it each time when they pay on the payment gateway).

There are configuration options to define whether the fields are enabled, in Admin Zone > Setup > Configuration > User/usergroup options > Special CPFs to show. You will especially need to do this for county and state if applicable to your demographic.

Additionally by default these fields are not enabled for direct editing by users, so you would need to edit them to enable 'Owner viewable' and 'Owner settable' for each field.
You can find and edit the fields from:
Admin Zone > Security > Members > Custom Profile Fields > Edit Custom Profile Field

The configuration options also impact what shipping/billing address fields show, but subtly:
 - County input:
  - If the County field is disabled then County input will not be available
 - State input:
  - If the State field is disabled then State input will not be available, unless the Business country is US (as it is required for tax calculation)
  - If the Business country is US then State input will be a drop-down list, otherwise it will be a free-text input
  - If the Country field is enabled or the Business country is not US then an 'N/A' option will be included on the list (to signify a non-USA state)
  - If a buyer's state selection is not appropriate for the country selection then an error message will be shown
 - Postcode/Zip input:
  - If the Postcode/Zip field is disabled then Postcode/Zip input will not be enabled, unless the Business country is US (as required for tax calculation)
  - If a buyer's Postcode/Zip selection is not appropriate for the country selection then an error message will be shown
 - Country input:
  - If the Country field is disabled the Business country will be used automatically for the buyer's shipping/billing address

[title="2"]Auditing[/title]

[title="3"]Handling refunds[/title]

[media width="150" description="Sales list management" float="right"]data_custom/images/docs/tut_ecommerce/sales_management.png[/media]
There is a module in the Admin Zone for sales list management at:
Admin Zone > Audit > eCommerce sales list management
The module should be used to cancel purchases, such as an e-mail address purchased up a user that is no longer valid. Cancelling such a purchase allows a re-purchase at a later date (only one address of each e-mail address type is allowed per-user).

You may also want to cancel whatever the purchase automatically did. This is not done automatically for you (&dagger;). For example, if a user bought name highlighting you can edit their account to un-highlight their name.

Cancelling does not automatically provide a refund.

[b]For monetary payments[/b]:
Refunds should be done on the payment gateway.

[b]For point payments[/b]:
Refunds must manually be given through the points system.

&dagger; Usergroup subscriptions can be cancelled from the subscriptions page, or from some payment gateways. Usergroup memberships automatically are removed when a subscription is terminated.

[title="3"]Charts[/title]

[surround]
[media width="150" description="A profit/loss account for a fresh install" float="right"]data_custom/images/docs/tut_ecommerce/ecommerce_pl.png[/media]
Composr includes some basic accountancy charting support. This is not intended as a replacement for a proper accountancy system, but does serve as a very useful overview of finances and a record of activity.

Composr can generate the following charts over a custom specified period:
 - Profit and loss account (Admin Zone > Audit > eCommerce > Profit/Loss account)
 - Cash flow diagram (Admin Zone > Audit > eCommerce > Cash flow diagram)

[box="Not for formal accounting purposes"]
[media float="right" thumb="0" framed="0"]data_custom/images/docs/dont.png[/media]
The developers do not accept any responsibility for the financial accounts of users of the Composr eCommerce system. Accountancy features are provided as an aid only and are not guaranteed to perform to match any legislative, tax, or accountancy conventions.
[/box]
[/surround][title="3"]Logs[/title]

Transaction logs can be viewed from:
Admin Zone > Audit > eCommerce > Logs

[title="2"]Payment gateways: advanced[/title]

[title="3"]Manual transactions[/title]

[surround]
[media width="150" description="Inputting a manual transaction" float="right"]data_custom/images/docs/tut_ecommerce/ecommerce_manual.png[/media]
Normally a transaction would go through via PayPal/etc. i.e. Composr sends a user off to PayPal, and then PayPal calls back saying the transaction has happened.

However, we've designed it to be modular. In Composr another method of doing a transaction is the 'manual transaction'. The manual transaction form just allows you to simulate a transaction from the Admin Zone; the idea is that you've received a cheque (or SMS payment, or whatever) and are manually telling Composr about it so that Composr can dispatch the sale. To perform a manual transaction you need to:
1) access the manual transaction screen (Admin Zone > Audit > eCommerce > Manual transaction).
2) select the right product
3) enter the correct ID number that the product will use to dispatch for this sale
4) enter the sale amount that the product expects to be receiving (which you can leave blank for it to work this out itself).

Manual transactions may also be used to input transactions that are totally external to Composr, and thus otherwise immeasurable by the charting. For example, an organisations expenditure may be recorded by manually inputting a negative transaction for the special 'Other' product.
[/surround]

[title="3"]Local payments[/title]

Composr supports taking in payments 'locally' (i.e. not redirecting to a third-party site to take the payment). Not all the payment gateways within Composr allow local payments though, either due to the gateways not supporting it or just because it has not yet been implemented. At the time of writing the Authorize.Net gateway supports it.

Local payments should be considered with great caution because it requires a high level of PCI compliance, a very complex and expensive (increasingly so) process that carries legal liability.

You will need a more expensive webhost that provides PCI compliance.

We have summarised the PCI compliance rules below in a way streamlined toward Composr. This summary is not a full representation of PCI compliance and you should read through everything yourself.

{|
! Headline
! Rule
! Applies to webhost
! Applies to website
|-
! Hardware firewall
| Have a hardware firewall that sits in front of all inbound traffic. Every protocol allowed through the firewall must have a strict justification. The webhost must maintain full schematic documentation around the firewall, including all possible data flows. Everything must be reviewed every 6 months.
| Yes
| No
|-
! Software firewall
| Any computer used to connect to the webhosting must have a software firewall enabled (e.g. the ones that come with Windows and Mac OS).
| Yes
| Yes
|-
! Antivirus
| Your webhosting servers, and any computer used to connect to the webhosting, must have anti-virus software enabled. This must be kept updated, do periodic scans and keep logs which are retained.
| Yes
| Yes
|-
! Penetration testing
| A PCI-approved scanning vendor must perform quarterly penetration testing on the network, repeating it until it passes.
| Yes
| No
|-
! Intrusion detection (1)
| Run fully-updated intrusion detection systems; any attacks or failures recorded and reported to management in a timely manner. Run a change detection system on core operating system files at least weekly.
| Yes
| No
|-
! Intrusion detection (2)
| Enable "Hacker/bot detected" notifications on an active administrator account in Composr. Run the [tt]rootkit_detector[/tt] addon at least weekly.
| No
| Yes
|-
! Accurate logging
| Normal system logging must be fully enabled, not tampered with, and kept for at least a year. The last 3 months of logging must be immediately available. The system clock must be synched to an online source.
| Yes
| Yes
|-
! Active security auditing
| Logs must be reviewed daily and any attacks or failures recorded and reported to management in a timely manner.
| Yes
| Yes
|-
! Limit access
| Only people needing the access may be given it to the extent that they need that access.
| Yes
| Yes
|-
! Separate accounts
| Each user must have their own account.
| Yes
| Yes
|-
! No default access
| No default passwords or unnecessary privileged default accounts may be in place.
| Yes
| No
|-
! Disable inactive accounts
| Inactive accounts must be disabled after 90 days using the Composr "Password expiry days" configuration option.
| No
| Yes
|-
! Stay patched
| Maintain an inventory of all relevant hardware and software items. Assess the security of each item. Keep all items patched for vulnerabilities, preferably via automatic nightly updates. Discard or replace anything that cannot be patched.
| Yes
| Yes
|-
! Secure shared hosting
| If using shared hosting then webhosting accounts must be fully isolated from each other, using a suEXEC-style system. This is basic and already recommended under our webhosting recommendations. Additionally consideration needs to be given to ensure log files are both maintained and isolated.
| Yes
| No
|-
! VPN
| Low level access to the webhosting (e.g. an SSH shell, phpMyAdmin, or a webhosting control panel) must require a VPN involving a secure key as well as the regular passwords. Each individual accessing user must have their own secure key.
| Yes
| No
|-
! Two-factor-authentication
| Within Composr the "Enquire on new IPs" option must be enabled on any administrative usergroups. All administrative users must understand why this is the case via a documented policy.
| No
| Yes
|-
! Database isolation
| The web server and MySQL server must be different machines [this actually comes from PA DSS].
| Yes
| No
|-
! Physical security
| The physical facilities must be kept secure with access control, ID badges, and video cameras. Sensitive areas in the facility must only be accessible to those that need it. The webhost must immediately revoke access for terminated employees or visitors leaving. Visitors must be audited in a log book (saying visitor name, company, and authorising employee). This book must be kept for at least 3 months.
| Yes
| No
|-
! Secure backups
| All physical backup media must be kept securely, strongly encrypted, access-limited, and destroyed when no longer needed.
| Yes
| Yes
|-
! No wifi
| Look for, and maintain an inventory of, any wifi networks connected to the webhosting network, on a quarterly basis. Any unauthorised networks must be recorded and reported to management in a timely manner.
| Yes
| No
|-
! SSL
| Use an SSL certificate for at least access to the [tt]purchase[/tt], [tt]shopping[/tt], [tt]invoices[/tt], [tt]members[/tt], [tt]join[/tt] and [tt]login[/tt] modules. Preferably just use an HTTPS base URL.
| No
| Yes
|-
! Avoid storing card data
| Only enable the "Store credit card numbers" configuration option (Admin Zone > Setup > Configuration > eCommerce options > General) if it is important to your business.
| No
| Yes
|-
! Screen developers
| Ensure any developers hired are highly competent at secure coding.
| No
| Yes
|-
! Information Security Policy
| Maintain an Information Security Policy. This must be in writing, cover all aspects of PCI compliance, kept updated, disseminated across staff, reviewed at least yearly, and compliance checked at least quarterly. It should include risk assessments, usage policies. There needs to be a process for initiating a timely forensic investigation in the case of a breach.
| Yes
| Yes
|-
! Screen staff
| Staff should be screened for criminal records, credit history, and employment history.
| Yes
| Yes
|}

[concepts
 1_key="PayPal"                        1_value="The most popular online payment gateway"
 2_key="Payment gateway"               2_value="A third-party infrastructure for performing eCommerce transactions"
 3_key="Instant Payment Notification"  3_value="A system, originally created by PayPal, for determining the progress of a financial transaction or ongoing subscription."
 4_key="Product"                       4_value="An item in the eCommerce system that defines everything relating to the natural view of a product or service, including handling of any actions associated with a sale being completed or retracted; these products are not like supermarket products -- they are very aggrandised and dynamic"
 5_key="PCI"                           5_value="The trade body for regulating eCommerce standards. When we refer to PCI compliance we are typically referring to PCI Data Security Standard (PCI DSS)."
 6_key="Shopping catalogue"            6_value="A special catalogue for listing items that may be purchased through the shopping cart"
 7_key="Shopping catalogue item"       7_value="An individual item in a shopping catalogue, another name for a catalogue entry which only applies to a shopping catalogue"
 8_key="Shopping cart"                 8_value="System for collecting and paying for one of more items from a shopping catalogue; typically these will be physical items that are shipped together"
 9_key="Purchasing module"             9_value="The [tt]purchase[/tt] module where one-off purchases are made"
 10_key="Transaction"                  10_value="A low-level record that an action took place (e.g. purchase, payment, or subscription change) in the eCommerce system"
 11_key="Sale"                         11_value="The act of something in the store being sold / purchased"
 12_key="Subscription"                 12_value="Something purchased that has recurring payments for as long as the subscription is open"
 13_key="Invoice"                      13_value="An invoice created for a website member to pay"
 14_key="Unit price"                   14_value="The price of an item (gross, i.e. pre-tax), before quantity multiplication is applied"
 15_key="Price"                        15_value="The price of an item(s) (gross, i.e. pre-tax); this term is used roughly"
 16_key="Amount"                       16_value="The amount being paid in a transaction; this term is used roughly and may or may not include the sales tax"
 17_key="Grand total"                  17_value="The total cost of an order including tax and shipping costs"
 18_key="Fee"                          18_value="A fee levied on your website for processing a transaction"
 19_key="Origin taxation"              19_value="USA taxation where taxes are levied based on where the seller (you) resides"
 20_key="Destination taxation"         20_value="USA taxation where taxes are levied based on where the buyer resides"
 21_key="Sales tax"                    21_value="The system for charging tax on sales, used in the USA and other countries"
 22_key="Use tax"                      22_value="The system for paying tax on purchases, used in the USA; buyers are meant to report purchases from other states they paid no tax on and pay those taxes"
 23_key="VAT"                          23_value="Alternative to a sales tax system, used in the EU and some other countries around the world"
 24_key="Tax code"                     24_value="The Composr term for identifying a particular kind of taxation to apply to a product"
 25_key="Tax derivation"               25_value="The Composr term for tracking what exact taxes are levied for a transaction"
 26_key="EU digital goods taxation"    26_value="A tax system in Europe that applies to digital sales, taxes are paid to the buyer's home country using that country's own tax rate"
 27_key="Tax invoice"                  27_value="A formal (legally-compliant) invoice showing exactly what was paid for a transaction, broken down by line-item, with individual taxation rates shown for each line-item"
 28_key="Customer"                     28_value="The member who purchased the product"
 29_key="Related member"               29_value="The member to whom a product applies (e.g. for a usergroup subscription, the member who was subscribed to the usergroup)"
 30_key="TaxCloud"                     30_value="A third-party web service for handling the complexities and filing of USA taxation"
 31_key="TaxJar"                       31_value="A third-party web service for handling the complexities of taxation in many international countries"
 32_key="IPN"                          32_value="Instant Payment Notification; when a payment is completed on a third party gateway (such as PayPal), the gateway will make a web request back to your Composr website (via [tt]/data/ecommerce.php[/tt]) containing information about the transaction and its payment status. IPN is set up by default in Composr. Note that IPN can only work if your site is publicly accessible; development environments (such as ones running on localhost) may be inaccessible via IPN by gateways."
 33_key="PDT"                          33_value="Payment Data Transfer; specific to PayPal, when a member completes payment on PayPal and is redirected by PayPal back to your Composr site, PayPal includes transaction information in the redirect so Composr can immediately confirm the transaction and its payment status (unlike IPN where Composr must wait for the gateway to send an IPN request through [tt]/data/ecommerce.php[/tt]). PDT must be set up in PayPal and in Composr to use it. See Specific gateway notes > PayPal."
]Concepts[/concepts]

[title="2"]See also[/title]

 - [page="_SEARCH:tut_catalogues"]Custom structured content (via catalogues)[/page]
 - [page="_SEARCH:tut_subcom"]Tools for subsites and subcommunities[/page]
 - [page="_SEARCH:tut_legal"]Legal and social responsibilities[/page]
 - [page="_SEARCH:tut_points"]Creating an economy/reward-system for members via points[/page]
 - http://offers.avalara.com/ebook/

{$SET,tutorial_tags,eCommerce,Development,shopping,ecommerce,expert}{$SET,tutorial_add_date,Aug 2008}{$SET,tutorial_summary,Use the eCommerce system to sell things. Usergroup subscription and member invoicing are available out-of-the-box.}[block]main_tutorial_rating[/block]
