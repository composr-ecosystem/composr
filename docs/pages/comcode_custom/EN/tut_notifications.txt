[title sub="Written by Chris Graham"]Composr Tutorial: Notifications[/title]

Composr includes a highly-configurable notification system for members to be alerted on what is going on.

[contents]decimal,lower-alpha[/contents]

[title="2"]Choosing notifications[/title]
[surround]
[media width="150" description="Setting notifications" float="right"]data_custom/images/docs/tut_notifications/notifications.png[/media]
There are a wide number of notifications that members can receive.
Some are set to be enabled by default, and some are only available based on privileges or configuration.

Some notifications allow fine-grained control, allowing you to choose to receive them only for certain notification categories. For example, with forum topic notifications you can choose to receive them only for certain forums. This is similar to what some forum software calls 'tracking'.
[/surround]

[box="Double notifications"]
[surround]
[media thumb="0" framed="0" float="right"]data_custom/images/docs/remember.png[/media]
If you enable notifications on a particular type, but also categories of that type, you will get doubled up notifications. As Composr allows fine-grained control of different kinds of notification we don't want to add overwhelming complexity by trying to do 'smart de-duplication'. Therefore if you get duplicated notifications check your settings.
[/surround]
[/box]

[title="2"]Forms of receipt[/title]

You can receive notifications through a number of means:
 - E-mail
 - Digest e-mail (i.e. in delayed batches; requires the system scheduler to be set up and the 'Enable digest notifications' setting to be enabled in Admin Zone > Setup > Configuration > Messages)
 - Private topics (requires the 'Enable private topic notifications' setting to be enabled in Admin Zone > Setup > Configuration > Messages)
 - {$IS_MAINTAINED,sms,SMS} (if configured, it may require payment for each text message sent)
 - Web notifications

Note that private topic receipt is disabled for topic-derived notifications, in order to stop massive growth in database size.

[title="3"]Web notifications[/title]

Web notifications are particularly useful. If you have the website open (or pinned open, which some browsers support), then visitors will be notified directly through the Composr user interface within a matter of seconds. From the list of recent/unread notifications, you can view an overlay with the full notification details, or a full page detailing all enabled web notifications from the last period of days.

Additionally, most platforms will allow native notification display:
 - in the Windows notification center
 - in the Mac OS notification center
 - in a browser's site notification area
 - in the main notification area of iPhone or Android phones -- This might not work on all devices

(If you don't want the interface to support this, you can remove the [tt]top_notifications[/tt] block from the default [tt]GLOBAL_HTML_WRAP.tpl[/tt] template and disable web notifications.)

[title="2"]Automatically monitor content you've touched[/title]

This option works to automatically set up a member to receive notifications on content they have interacted with. This happens at the point of them making an interaction -- it automatically sets up a monitor. It is not retroactive.

Members have this set automatically if the global "Auto-monitor posted content" configuration option (Admin Zone > Setup > Configuration > Messages > Notifications) is enabled.

[title="2"]Smart Topic notification[/title]

The "Smart Topic notification" option works to stop members being flooded with notifications for a topic, until they've caught up. It sends them just one notification until they have read it again.

[title="2"]Debugging[/title]

You may wish to see what notification e-mails are being sent out.

The best way to debug notifications is to view the e-mail log, from Admin Zone > Audit > E-mail queue/log. You can see exactly what e-mails were sent out.

To see if someone is set up for notifications on some content, use the SU feature (see the [page="_SEARCH:tut_permissions"]Testing access and privileges[/page] tutorial, Access control and privileges section) to pretend to be them. You will see their settings reflected in the interface.

There's a config option, "Carbon-copy e-mail address". This address receives a copy of most e-mails the system sends out.
Note that it will only CC a notification e-mail to this address once, not once per notification.

[title="2"]Limits[/title]

If the number of categories for a notification exceeds the value of the "Safety listing limit" configuration option (Admin Zone > Setup > Configuration > Content editing options > Advanced) then a full selection tree will not be provided under the advanced notification settings.
For example, if you have a large number of download categories, the Download notification will not show a full download category tree.
Instead, only the IDs of notification categories that the user has already monitored will show. New notifications may be set via clicking Monitor buttons when browsing through content in the normal fashion.

[title="2"]Defaults[/title]

[media width="150" description="Setting notification defaults" float="right"]data_custom/images/docs/tut_notifications/defaults.png[/media]
Many notifications have inbuilt defaults which are set for all members until or unless they change their settings or they are changed in the &ldquo;Notification defaults&rdquo;. Site staff can change the notification defaults (Admin Zone > Setup > Notification defaults).

You will see the following columns:
 - Notification title (the column title is actually unlabelled, but this is what it is)
 - "Privileged / Restricted" -- this is Yes or No, and shows the general access for this notification in Composr (it is non-configurable, shown for informative purposes only)
 - "Use inbuilt default" -- this is a checkbox, defaulting to 'On'. If you uncheck it then the members will have the default settings that you choose in the interface. If it stays checked, the rest of the checkboxes have no effect. Hovering over this checkbox will also show a tool-tip explaining the inbuilt default for that notification.
 - (All the different ways of receiving notifications) -- the checkbox selections here determine [i]specifically[/i] which notifications will be enabled or disabled by default.

[title="2"]Lock-down[/title]

[media width="150" description="Setting notification lock-downs" float="right"]data_custom/images/docs/tut_notifications/lockdown.png[/media]
In the Admin Zone you can define what notifications are "locked-down". You can use this to:
 - Stop any member from receiving particular notifications
 - Force members to receive particular notifications types

This is particularly useful if you want to prevent your site from sending a bunch of mail when you have outgoing mail limits on your webhost.

Locked-down notifications will show on a member's notification settings, but the checkboxes cannot be changed. This is so members are informed which notifications they may or may not receive which they cannot change.

Set lock-downs from Admin Zone > Setup > Notification lock-down.

You will see the following columns:
 - Notification title (the column title is actually unlabelled, but this is what it is)
 - "Privileged / Restricted" -- this is Yes or No, and shows the general access for this notification in Composr (it is non-configurable, shown for informative purposes only)
 - "Not locked down, free choice" -- this is a checkbox, defaulting to 'On'. If you uncheck it then the members will have the settings that you choose in the interface (i.e. they can no longer choose their own settings). If it stays checked, the rest of the checkboxes have no effect. Hovering over this checkbox will also show a tool-tip explaining the inbuilt default for that notification.
 - "Member's typical notification type" -- specifies that a notification will be forcibly sent out in the member's average way they've set to receive notifications
 - (All the different ways of receiving notifications) -- the checkbox selections here determine [i]specifically[/i] how members will forcibly receive this notification (you will not typically use this in combination with "Member's typical notification type").

If no checkboxes are checked then the members will not be able to receive the notification at all. This is quite a common configuration, essentially allowing you to turn off a notification for the whole website.

Note that the settings apply to all members (while respecting the notification permissions). We do not support usergroup-based notification lock-downs. It is a feature that may be requested and sponsored if you would like to see it.

[title="2"]Security[/title]

Notifications broadly fall into 3 classifications:
1) Notifications sent directly to a specific member, relating to them
2) Privilege-affected notifications, e.g. monitoring a download category, and hence needing access to that category to receive the notification
3) Staff notifications

To stop Composr becoming bloated/over-complex, there is no configurable granularity with Staff notifications. Any one with the "May listen to notifications intended for staff" privilege may receive them.

However, you may come into a situation where you do want some granularity. A nice workaround is to have a staff account with a gmail address, and use gmail forwarding rules to forward to others based upon subject line. Then deny regular staff the "May listen to notifications intended for staff" privilege.

[title="2"]Digests[/title]

Digest e-mails provide combined summaries of activity.

It is possible digest e-mails could become very long. In this case, Composr would struggle to parse their Comcode, or the mail client may struggle with such large e-mails. Composr therefore implements a 256kb limit per digest.

When a digest limit is reached, the remaining contents are deferred to another e-mail to be sent out an hour later.

Digest e-mails are also typically viewable in the web browser in their full form providing that e-mail logging is enabled and the e-mail has not yet been cleaned up from the logs. A web version link is provided in the e-mail. This is, of course, subject to the web server's ability to handle the size of the e-mail and render it without reaching the PHP memory limit. If even the web version is very long, it will be rendered in raw Comcode text format instead of parsing the Comcode into HTML (Tempcode).

[title="3"]Debugging[/title]

Digests are sent out via the system scheduler. A member can only choose to receive digests if the system scheduler is set up, if 'Enable digest notifications' is enabled in Messages configuration, and if they have configured an e-mail address.

Digests are not sent out at any specific time (to avoid overloading outbound e-mail each night), but rather each member's digests are individually time-tracked using the [tt]digestives_consumed[/tt] table. For each member there is a timestamp in that table representing when each of their digest's was last sent. When the system scheduler runs it looks to see what digests are due and sends them if there's any content for them.

Actual digest content is queued up in the [tt]digestives_tin[/tt] table.

[title="2"]See also[/title]

 - [page="_SEARCH:tut_correspondence"]Correspondence between members[/page]
 - [page="_SEARCH:tut_email"]Understanding and configuring e-mail[/page]
 - [page="_SEARCH:tut_members"]Composr member system[/page]
 - [page="_SEARCH:tut_forum_tracking"]Keeping on track of busy forums[/page]

{$SET,tutorial_tags,Members,Administration,sms,core_notifications,novice}{$SET,tutorial_add_date,Aug 2013}{$SET,tutorial_summary,How different kinds of notifications may be set up in Composr.}[block]main_tutorial_rating[/block]
