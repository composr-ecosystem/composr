[title sub="Written by Chris Graham (ocProducts)"]Composr Tutorial: Dealing with annoying users[/title]

Composr provides a number of ways to deal with the annoying users or the users who do not adhere to your site policies (for a good discussion of site policies see the [page="_SEARCH:tut_legal"]Legal and social responsibilities[/page] tutorial).

Some of these tools actively enforce your policy, some of them allow you to 'moderate' to maintain your own policy, and some of them provide punishment for users that abuse policy (such that they may be removed from causing further harm, or made an example of such that other users do not 'follow suit').

[contents]decimal,lower-alpha[/contents]

[title="2"]Active filters (word filter and field filter)[/title]

[media width="150" description="Working with the word filter" float="right"]data_custom/images/docs/tut_censor/censor_word.png[/media]
{!wordfilter:DOC_WORDFILTER}

Access the word filter from:
Admin Zone > Security > Word filter.

The word filter makes no attempt to try and detect when users try to 'cheat it', as this would be a futile struggle: if users abuse the filter, then they are almost certainly knowingly that they are doing so, and thus setting themselves up for punishment.

In addition to the word filter there is a more sophisticated filtering system, the [page="_SEARCH:tut_fields_filter"]The form field filter system[/page].

[title="2"]Validation[/title]

Composr, by default, will not allow most forms of non-trusted content to appear live on the website without validation by the staff. When a user that is not in a trusted usergroup posts content, then they will have no choice but to have it posted as non-validated, and a notification will be dispatched to the staff. The staff can then choose what to do with the content (as part of their "moderation" duties).

There is a module where staff can see all non-validated content (in case the notification was missed or disabled):
Admin Zone > Audit > Non-validated resources

By default, the forum, the chatrooms, and Wiki+, are the main exceptions where validation is not required. This is because these are community orientated areas of the website, where instant posting is desirable.

Naturally, privileged users may edit and delete any content on the system; by default, these privileged users are those in the staff usergroups. It is possible to configure Composr so that users may edit/delete their own content though, or even all content if you like.

It's a common practice to use rank to automatically grant additional access, such as bypassing validation. Rank is discussed in the [page="_SEARCH:tut_subcom"]Tools for subsites and subcommunities[/page] tutorial.

[title="2"]Content privacy[/title]

Members may specify the privacy settings for content they post, if the [tt]content_privacy[/tt] addon is installed. For example, they may post an image and set it so only their friends may view it.

[title="2"]Warnings / Punishments[/title]

[surround]
[media width="150" description="Using the points system for punishment" float="right"]data_custom/images/docs/tut_censor/censor_point_in_right_direction.png[/media]
There are a number of ways to punish members who do not follow site policy (such as trolls), including:
 - Charging points from the member
 - Banning them in various ways described under "Banning"
 - Moving them to a restricted usergroup (there's an inbuilt "Probation" feature to move them automatically into probation usergroup for a limited period of time)
 - 'Verbally' (unofficially) warning them, via a Private Topic or other means of private communication
 - Giving them a formal warning via the warn form (read on)

As all these methods work on members, but only banning by IP address works for guests, you may wish to consider making it a requirement for all users to join in order to participate on the website. In other words, you may wish to remove permission for guests to make submissions.
[/surround]

[surround]
[media width="150" description="A warning as displayed on the account of a member" float="right"]data_custom/images/docs/tut_censor/censor_warning.png[/media]
[media width="150" description="Making a warning / potentially other punitive actions" float="right"]data_custom/images/docs/tut_censor/censor_make_warning.png[/media]
[media width="150" description="Links for member warning from their profile" float="right"]data_custom/images/docs/tut_censor/member_links.png[/media]
All the various punishment tools are brought together for convenience on one screen named "Warn member" (Conversr only).

This screen can be accessed from either:
1) members' post ("Warn" button)
2) or, from any member-profile screen ("Warn member" or "Deal with as spammer" under Audit)

[title="3"]Warnings Form[/title]

The warnings form consists of the following options that can be utilised to easily deal with problematic members or spammers:
 - [b]Warning Type[/b]: A "Formal Warning" counts towards the member's total number of warnings, whereas an "Off-the-book Warning" does not. Furthermore, off-the-book warnings are not listed to the member on their profile.
 - [b]Punitive Actions[/b]
  - [b]Ban the member's IP address[/b]: Bans the last-known IP address of the member so they (and others) can no longer access the website from that IP. The ban is performed on the .htaccess file so they cannot even access the website anymore.
  - [b]Ban member[/b]: Unlike banning the IP address, the member can still access the website. But they can no longer log in to / use their account.
  - [b]Change usergroup to[/b]: Change the primary usergroup which this member belongs (such as to de-rank them).
  - [b]Extend probation[/b]: Start a probation period, or extend an existing one, by this many days. The member will only have the permissions assigned to the "Probation" usergroup regardless of any other usergroup they are in.
 - [b]Delete content[/b]
  - A list of recently posted content by the member will appear in this section. You can choose which content to delete. This is handy for quickly mass-deleting spam content posted by a member.
 - [b]Charge or Reverse Points[/b]
  - A list of point transactions involving this member within the last 7 days (50 maximum) will appear. You can choose which ones to reverse. You do not have to reverse ones for which you are deleting the associated content; they will be reversed automatically. Reversed points will be subtracted from the member's life-time points, unlike charging points.
  - [b]Charge points[/b]: Take points away from the member. It is permissible to charge more points than they have in their balance; this will put their balance in negative points. Charges will add an anonymous record in the points ledger. Charges will [b]not[/b] subtract from the member's life-time points.
 - [b]Explanatory Text[/b]
  - You can load a previously-saved explanatory reason and message by clicking the "Load an explanation/message" link.
  - [b]Reason[/b]: A brief reason / explanation for the warning, used in the logs. You might reference rule numbers or Terms of Service section numbers that were violated in here.
  - [b]Message[/b]: You have the ability to write a Private Topic message to be sent to the member for their warning. You could include details about what punitive actions you are taking, reminders to re-read the rules / next steps to take, repercussions for future violations, and so on. You may not want to include punitive actions in this field if you tick (check) the [tt]Include punitive actions in message[/tt] tickbox (checkbox).
  - [b]Save explanatory details[/b]: If you want to save what you wrote in the "Reason" and "Message" fields for later use, you can provide a name here. The next time you want to use it, click the "Load an explanation/message" link at the top of the "Explanatory Text" section to pre-populate a saved reason and message. If you have [tt]Include punitive actions in message[/tt] ticked (checked), the auto-generated punitive actions are not included in the saved message.
  - [b]Include punitive actions in message[/b]: Auto-generate information about what punitive actions you are taking for the Private Topic sent to the member. This is beneficial so you do not have to write them yourself in the message. But it also allows you to better manage saved reasons / messages; you can re-use a saved reason / message without having to edit it for the punitive actions you are taking now.

All punitive actions are defined in hooks under [tt]hooks/systems/cns_warnings[/tt]. You can develop additional punitive actions for the warnings system (e.g. through non-bundled addons) by making new hooks. See the "ban_member" hook for a basic example. In each hook are the following methods:
 - [b]get_details[/b]: return null to disable the hook or an array of details, such as 'order' to define the field order on the warnings form.
 - [b]generate_text[/b]: generate past-tense text to explain the punitive action taken (used in the warnings history)
 - [b]get_form_fields[/b]: renders / attaches form fields, intro paragraph text, and/or hidden fields on the warning form for this punitive action
 - [b]actualise_punitive_action[/b]: actualises / applies the punitive action on the member. This gets called for every hook when the warning is submitted, so you should check if an action should actually get applied via POST parameters from the form. You must add a record into the f_warnings_punitive table for each punitive action applied, and you should also call log_it or cns_mod_log_it. The warnings module does not do these automatically as some hooks may apply more than one punitive action (e.g. deleting multiple forum posts). The logs will be associated with the warning ID.
 - [b]undo_punitive_action[/b] (optional): reverses a punitive action when a staff member clicks "Undo" on the warning history for the action. If the method is not defined, then no undo action will be allowed for this hook. You do not need to do anything with f_warnings_punitive here; the warnings module will take care of that. However, you should log_it or cns_mod_log_it the reversal. The log will be associated with the warning ID. Note that if actualise_punitive_action applies more than one action, then each action will have their own individual undo capability, so undo_punitive_action should not undo more than one action at a time.

A note about Private Topics sent for warnings: A private topic will not get sent to the member for their warning if nothing is written in the "Message" field and "Include punitive actions in message" is unticked (unchecked). Also, if "Message" is blank but "Include punitive actions in message" is ticked (checked), a private topic will get sent, but it will only contain the punitive actions taken.

[title="3"]Probation[/title]

The probation feature is designed to work via the warnings system. You could manually put a member into the probation usergroup, but it's not advisable because any secondary usergroups they are in may lead to extra undesirable privileges. The recommended method is to set the time until which they finish probation, either via editing their account or using the warn form.

If you use the warnings system to put a user in probation, Composr automatically returns their only usergroup as Probation, disregarding other settings until their probation expires. Their usergroups will continue to [i]display[/i] as normal, but from a permission point of view, they'll only be in the probations usergroup.
[/surround]

[title="3"]Banning[/title]

[surround]
[media width="150" description="Banning a member via editing their member account" float="right"]data_custom/images/docs/tut_censor/censor_member.png[/media]
There are many methods for banning a Composr user:
 - [b]Banning a member[/b] via editing their member account. This is perhaps the most useful method of banning and shows them an error when they next log in telling them they've been banned. Note that there is no way to prevent a user re-joining with a new username; members can still re-join with a different IP, username, and/or e-mail address.
 - [b]Banning an IP address[/b], or IP address range. {!submitban:DOC_IP_BAN} More information about IP addresses is given in the [page="_SEARCH:tut_trace"]Using IP addresses to trace users[/page] tutorial.
 - 'Banning' a member via [b]changing their usergroup[/b] to one with virtually no privileges. This is useful if you want to reduce access in a highly customised fashion.
 - [b]Banning member submission[/b]. This is useful if you only want to ban a member from making submissions, and not the whole site; it is done from the Action Logs module (accessed from Admin Zone > Audit > Action logs). This feature is also useful if you are not using [concept]Conversr[/concept], and want to ban a member in Composr, but not in the forum.
[/surround]

[title="4"]Advanced banning[/title]

Some sites may experience very persistent and difficult spammers. Composr is good for automatically penalising/blocking bots. Composr has great tools for dealing with regular spammy users. However, human users in poorer countries may earn a living by repeatedly going through large numbers of sites (perhaps on a spreadsheet), manually registered and posting spam under fresh accounts (including fresh e-mail addresses and fresh IP addresses) each time. As the e-mail addresses of such users are throw-away, it can be impossible to contact them to even let them be aware that you are deleting their spam and their efforts are worthless. Spammers can use different IP addresses to post by using proxies (which may be hacked servers), or simply by forcing a new IP address to be pulled from their ISP.

Composr has 2 advanced banning features to deal with this:
1) Automatic banning -- ban users who post certain strings, in a definable way (before the spam even can go through)
2) Reasoned bans -- show special messages to banned users

Reasoned bans may often be used to scare a spammer that you have researched but otherwise cannot contact. You can provide customised responses to them to let them know you are treating their spam seriously.

Configure reasoned bans in XML from Admin Zone > Setup > Configuration > Configure advanced banning -- or by hand-editing [tt]data_custom/xml_config/advanced_banning.xml[/tt] based on the default [tt]data/xml_config/advanced_banning.xml[/tt].

Here's an example based on some actual spam that was affecting the compo.sr forums:
[code="XML"]
<advancedBans>
	<automaticRule trigger="https://americanmadepro.com/" pages="topics" types="_new_topic" action_member_ban="true" action_reasoned_ban="pakistani_spammer" action_ip_ban="false" />

	<reasonedBan codename="pakistani_spammer" http_status="451" title="Violation of The Prevention of Electronic Crimes Act, 2016" image_url="uploads/website_specific/spam/logo.png" message="Your account has been found in violation of [url=&quot;Islamic Republic of Pakistan - Ordinance LXXII&quot;]uploads/website_specific/spam/law.pdf[/url]. Your account is therefore banned, pending possible legal action for the entity behind {IP_ADDRESS}." />
</advancedBans>
[/code]

Here we are automatically banning users posting a link to a certain website; upon review we found the spammers were mostly posting from Pakistan, and the website was hosted in Pakistan. We do not IP-ban them because we want them to actually see the ban message. The ban message lets the spammer know they are in violation of Pakistani law, with a link to the copy of the law we hosted, the logo of the Pakistani government to make it look official, and their IP address. A "blocked for legal reasons" HTTP status is used.

There is also a [tt]redirect_url[/tt] parameter for [tt]reasonedBan[/tt] that we are not using, that will redirect the banned member to a URL of your choice.

This system may seem extreme, but sometimes extreme measures are needed to deal with the most persistent of spammers. It could also be used to deal with people posting far-right/far-left/Islamist material that is designed to radicalise people into violent revolution -- by banning such people and redirecting those people to a deradicalisation programme. 

Note that reasoned bans will not work when banning someone by IP address. The software intentionally bails out early with a generic error message when someone tries accessing the site from a banned IP address. This means the reasoned ban system never gets loaded when that happens.

Automatic bans are similar to the security alerts (hack-attacks). The difference is hack-attacks are general hacker/spammer signals Composr is hard-coded to be able to detect, are individually logged as incidents, and cumulate towards IP bans -- while automatic bans are custom defined by the webmaster for clear specific threats, resulting in immediate configurable banning.
The advanced banning configuration also has [tt]<hackattack>[/tt] rules, which are documented in the [page="_SEARCH:tut_security"]Security[/page] tutorial.

[title="2"]The Action Log (audit trails)[/title]

[surround]
{!actionlog:DOC_ACTIONLOG}

[media width="150" description="Recent actions performed" float="right"]data_custom/images/docs/tut_censor/adminzone_recent_actions.png[/media]
This module shows the recent actions performed by you and your staff. Virtually every action that is done by your staff is logged here, which at the time of writing is around 300 actions.
 - [b]Username[/b] is the name of the member who performed this action
 - [b]IP Address[/b] is the [concept]IP address[/concept] of the member who performed this action.
 - [b]Date and Time[/b] is the date and time when the action occurred. You may click this date to view further details on the submission as well as do (un)banning related to it.
 - [b]Action[/b] is the name of the action they performed.
 - [b]First Parameter[/b] is one of the parameters of that action -- which will differ from action to action.
 - [b]Second Parameter[/b] is one of the parameters of that action -- which will differ from action to action.

There are also 'sort by' and 'show per page' options at the bottom of this module to help you refine which recent actions you see.

Access the action log from:
Admin Zone > Audit > Action logs (audit trail)

[title="3"]Filtering by parameters[/title]

In order to search by First/Second parameter you'll need to know what they are for whatever action you are searching. There is no documentation on what they mean, but you can ascertain it by browsing past actions of the type you want to search. They are often IDs and human-readable titles.

[title="3"]Notifications[/title]

Staff may set up a notification so they know whenever anything is added to the action log. This will not be sent out for entries that only relate to private data accesses, however (as those are potentially very high-traffic).
[/surround]

[title="2"]Post history[/title]

[surround]
[media width="150" description="Post history" float="right"]data_custom/images/docs/tut_censor/censor_post_history.png[/media]
If you are using Conversr, then you may make use of the 'post history' feature. This feature was designed for the situation where a member has edit and delete permission over their own posts, and abuses it to hide evidence of their own misdeeds. For staff, a 'history' button is provided by any edited post, and a 'history' button by any topic with post-deletion history. The interface under these buttons allows:
1) viewing of old versions
2) restoration of what was deleted
3) the ability for staff to eternally erase posts from the history record.
[/surround]

[concepts
 1_key="Post history"   1_value="The stored text of posts, from before edit and delete actions on them"
 2_key="Validation"     2_value="The process of checking submitted content is suitable for display on the website"
]Concepts[/concepts]

[title="2"]See also[/title]

 - [page="_SEARCH:tut_trace"]Using IP addresses to trace users[/page]
 - [page="_SEARCH:tut_legal"]Legal and social responsibilities[/page]
 - [page="_SEARCH:tut_staff"]Coordination between staff and staff/members[/page]
 - [page="_SEARCH:tut_members"]Composr member system[/page]
 - [page="_SEARCH:tut_moderation"]Basic forum moderation[/page]
 - [page="_SEARCH:tut_fields_filter"]The form field filter system[/page]
 - [page="_SEARCH:tut_antispam"]Anti-spam settings[/page]

{$SET,tutorial_tags,Security,wordfilter,unvalidated,cns_warnings,content_privacy,actionlog,Administration,novice}{$SET,tutorial_add_date,Aug 2008}{$SET,tutorial_summary,Little tricks: changing their permissions via usergroups, mandating prior post approval, and how to ban them.}[block]main_tutorial_rating[/block]
